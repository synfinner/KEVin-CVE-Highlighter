// background.js

// Define the base API URL
const API_URL = 'https://kevin.gtfkd.com/kev/exists';

// Function to check KEV status for a given CVE ID
async function checkKEV(cveId) {
  const url = `${API_URL}?cve=${cveId}`;

  try {
    const response = await fetch(url, {
      method: 'GET',
      headers: {
        'x-kevin-source': 'Chrome Extension',
        'Content-Type': 'application/json'
      }
    });

    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    const data = await response.json();
    return { cveId, inKEV: data.In_KEV };
  } catch (error) {
    console.error('Error fetching KEV data:', error);
    return { cveId, inKEV: false, error: error.message };
  }
}

// Listener for messages from content scripts
chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
  if (request.action === 'checkKEV') {
    const cveId = request.cveId;

    checkKEV(cveId)
      .then(result => sendResponse(result))
      .catch(error => sendResponse({ cveId, inKEV: false, error: error.message }));

    // Return true to indicate that the response is asynchronous
    return true;
  }
});